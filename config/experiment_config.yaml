# Experiment Configuration for Customer Personalization Orchestrator
# Task 4.1: Experiment Design
# Created: 2025-11-23

experiment:
  name: "personalization_poc_v1"
  description: "A/B/n test of personalized variants vs generic control"
  experiment_id: "EXP_POC_001"
  created_at: "2025-11-23T16:00:00Z"
  
  # Experiment Design Structure
  design:
    num_treatment_arms: 3  # One per segment tone (urgent, informational, friendly)
    control_arm: true      # Generic baseline message
    assignment_strategy: "stratified_random"  # Balanced within segments
    
  # Sample Allocation Strategy
  sample_allocation:
    control_percent: 25    # 25% get generic control message
    treatment_percent: 75  # 75% split across 3 treatment arms (25% each)
    
  # Treatment Arms Definition
  arms:
    control:
      name: "control"
      description: "Generic baseline message (same for all segments)"
      variant_type: "generic"
      
    treatment_1:
      name: "treatment_1"
      description: "Personalized urgent tone variants"
      variant_type: "personalized"
      tone: "urgent"
      
    treatment_2:
      name: "treatment_2" 
      description: "Personalized informational tone variants"
      variant_type: "personalized"
      tone: "informational"
      
    treatment_3:
      name: "treatment_3"
      description: "Personalized friendly tone variants"
      variant_type: "personalized"
      tone: "friendly"

  # Primary and Secondary Metrics
  metrics:
    primary: "click_rate"
    secondary:
      - "open_rate"
      - "conversion_rate"
    
  # Statistical Testing Configuration
  statistical_testing:
    alpha: 0.05           # Significance level (5%)
    test_type: "t_test"   # t-test for continuous metrics
    power: 0.80           # Desired statistical power (80%)
    minimum_detectable_effect: 0.10  # 10% relative lift
    
  # Sample Size Requirements (calculated)
  sample_size:
    total_customers: 250   # Available from segmentation
    per_arm_target: 62     # 250 / 4 arms = ~62 per arm
    minimum_per_arm: 50    # Minimum for statistical power
    
  # Engagement Simulation Parameters
  simulation:
    use_historical_data: false  # Use simulation for POC
    baseline_rates:
      open_rate: 0.25          # 25% baseline open rate
      click_rate: 0.05         # 5% baseline click rate  
      conversion_rate: 0.01    # 1% baseline conversion rate
      
    # Expected uplift for personalized variants
    expected_uplift:
      mean: 0.15              # 15% mean uplift
      std_dev: 0.05           # 5% standard deviation
      min_uplift: 0.05        # Minimum 5% uplift
      max_uplift: 0.30        # Maximum 30% uplift
      
    # Simulation settings
    random_seed: 42           # For reproducible results
    noise_factor: 0.02        # 2% random noise in engagement

  # Control Message Configuration
  control_message:
    subject: "Special Offer: Upgrade Your Experience Today"
    body: |
      Dear Valued Customer,
      
      We're excited to share a special offer with you! Upgrade your experience with our premium features and enjoy enhanced capabilities designed to meet your needs.
      
      Our premium offerings include advanced features, priority support, and exclusive access to new capabilities. Take advantage of this limited-time opportunity to enhance your experience.
      
      Don't miss out on this chance to upgrade and enjoy all the benefits we have to offer.
      
      Click here to learn more and upgrade today!
      
      Best regards,
      The Team
    tone: "neutral"
    citations: []  # Generic message has no specific citations

# Power Analysis Configuration
power_analysis:
  effect_sizes: [0.05, 0.10, 0.15, 0.20]  # Range of effect sizes to test
  sample_sizes: [50, 75, 100, 125, 150]   # Range of sample sizes to test
  alpha_levels: [0.01, 0.05, 0.10]        # Significance levels to test

# Segment-Specific Configuration
segments:
  "High-Value Recent":
    expected_baseline_open: 0.30    # Higher engagement expected
    expected_baseline_click: 0.08
    expected_uplift: 0.20           # 20% uplift expected
    
  "Standard": 
    expected_baseline_open: 0.25    # Average engagement
    expected_baseline_click: 0.05
    expected_uplift: 0.15           # 15% uplift expected
    
  "New Customer":
    expected_baseline_open: 0.20    # Lower baseline engagement
    expected_baseline_click: 0.03
    expected_uplift: 0.10           # 10% uplift expected

# Assignment Strategy Details
assignment:
  method: "stratified_random"
  stratification_variable: "segment"
  balance_tolerance: 0.05          # ±5% balance tolerance
  
  # Assignment process
  steps:
    1: "Group customers by segment"
    2: "Within each segment, randomly shuffle customers"
    3: "Assign first 25% to control"
    4: "Assign remaining 75% equally to treatment arms"
    5: "Validate assignment balance"

# Quality Assurance
quality_checks:
  assignment_balance:
    enabled: true
    tolerance: 0.05              # ±5% from target allocation
    
  segment_representation:
    enabled: true
    min_per_segment_per_arm: 5   # Minimum customers per segment per arm
    
  variant_availability:
    enabled: true
    require_all_tones: true      # All 3 tones must be available per segment

# Logging and Audit
logging:
  assignment_log: "data/processed/experiment_assignments.json"
  metrics_log: "data/processed/experiment_metrics.json" 
  audit_log: "logs/experiment_audit.log"
  
  # What to log
  log_assignment_details: true
  log_engagement_simulation: true
  log_metrics_calculation: true
  log_statistical_tests: true